<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Nebulous Memory</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; }
        /* 底部中央的纯净加号 */
        #upload-trigger {
            position: fixed; bottom: 8%; left: 50%; transform: translateX(-50%);
            width: 50px; height: 50px; border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.5);
            font-size: 28px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 100; transition: 0.8s; backdrop-filter: blur(5px);
        }
        #upload-trigger:hover { border-color: #fff; color: #fff; transform: translateX(-50%) scale(1.1); }
        /* 对话框在上传后悄悄出现 */
        #chat-area {
            position: fixed; bottom: 18%; left: 50%; transform: translateX(-50%);
            width: 320px; opacity: 0; transition: 2.5s; z-index: 100; text-align: center;
        }
        input { 
            width: 100%; background: transparent; border: none; border-bottom: 1px solid rgba(255,255,255,0.1); 
            color: #fff; text-align: center; padding: 10px; outline: none; font-size: 14px; 
        }
    </style>
</head>
<body>

<div id="upload-trigger" onclick="document.getElementById('file-input').click()">+</div>
<input type="file" id="file-input" style="display:none" accept="image/*">

<div id="chat-area">
    <div id="ai-thought" style="color:#fff; margin-bottom:15px; font-size:15px; line-height:1.8;"></div>
    <input type="text" id="user-response" placeholder="...">
</div>

<script type="importmap">{ "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }</script>

<script type="module">
    import { NebulaEngine } from './nebula.js';
    import { Brain } from './brain.js';

    const engine = new NebulaEngine();
    let questions = Brain.getRandomQuestions();
    let step = 0;

    document.getElementById('file-input').onchange = (e) => {
        const file = e.target.files[0];
        if(file) {
            engine.generatePointCloud(URL.createObjectURL(file));
            document.getElementById('upload-trigger').style.opacity = '0';
            document.getElementById('chat-area').style.opacity = '1';
            updateAI();
        }
    };

    function updateAI() {
        document.getElementById('ai-thought').innerText = step < questions.length ? questions[step] : "以此为名，归于星海。";
    }

    document.getElementById('user-response').onkeypress = (e) => {
        if(e.key === 'Enter' && e.target.value) {
            if(step >= questions.length) location.reload(); // 暂时简单处理
            e.target.value = ""; step++; updateAI();
        }
    };
</script>
</body>
</html>
